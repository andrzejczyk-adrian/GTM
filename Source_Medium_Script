<script>
  // Funkcja do ustawiania ciasteczka
  function setCookie(name, value, days) {
    var expires = "";
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/; Secure; SameSite=Lax";
  }

  // Funkcja do wyciągania parametrów z URL
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
  }

  // Lista wykluczonych domen
  var excludedDomainsRegex = /(?:enaturalnie\.pl|tagassistant\.google\.com|poczta\.wp\.pl|poczta\.interia\.pl|poczta\.o2\.pl|poczta\.onet\.pl|poczta\.gazeta\.pl|mail\.google\.com|zasobygwp\.pl|system\.t-mobilebankowe\.pl|system\.aliorbank\.pl|sgb24\.pl|secure\.payu\.com|secure\.getinbank\.pl|rwd\.bskrasnystaw\.pl|plusbank24\.pl|platnosci\.pl|platnosci\.pekao24\.pl|planet\.bnpparibas\.pl|pekaobiznes24\.pl|pbn\.paybynet\.com\.pl|payu\.com|paypal\.com|online\.sbrbank\.pl|online\.sbppiaski\.pl|online\.pbssokolow\.pl|online\.mbank\.pl|online\.bsgorzyce\.pl|online\.bsgarwolin\.com\.pl|online\.bsbr\.pl|online\.bs\.bialystok\.pl|net-bank\.bszgierz\.pl|nestbank\.pl|mtransfer\.mbank\.pl|login\.ingbank\.pl|konto\.sblzlotow\.com\.pl|konto\.bskobierzyce\.pl|konto\.bs-zywiec\.pl|ipko\.pl|inteligo\.pl|ibank\.sanbank\.pl|ibank\.bskoscierzyna\.pl|ib\.bsbialogard\.pl|epayments\.goonline\.bnpparibas\.pl|ekonto\.bskonin\.pl|ebsd\.pl|ebs\.bsostrowmaz\.pl|ebs-zabkowicesl\.pl|eborwd\.bsjasionka\.pl|ebo\.bsstaszow\.pl|ebo\.bsjarocin\.pl|ebo\.bs-suchedniow\.com\.pl|ebo\.bankbbs\.pl|ebn\.silesiabank\.pl|eblik\.pl|ebank\.pbsgostyn\.pl|ebank\.mazoviabank\.pl|ebank\.bsskierniewice\.pl|ebank\.bsnowytarg\.pl|ebank\.bslacko\.pl|ebank\.bsjordanow\.pl|ebank\.bsjablonka\.pl|ebank\.bsglogowek\.pl|e24\.bsmilicz\.com\.pl|e\.pbskkozle\.pl|e\.bssejny\.pl|e\.bsrabawyzna\.pl|e\.bsnarol\.pl|e\.bsgrybow\.pl|e\.bsgrodzisk\.pl|e\.bsglogow\.pl|e-bsw\.pl|e-bank\.gbsmiedzyrzecz\.pl|cloud\.ideabank\.pl|citibankonline\.pl|centrum24\.pl|cbp\.cui\.pl|ca24\.credit-agricole\.pl|bswschowa24\.pl|bswolczyn24\.pl|bstorun24\.pl|bsradzyn24\.pl|bsnidzica\.cui\.pl|bskrotoszyn\.cui\.pl|bsjaroslaw\.cui\.pl|bsbiecz24\.pl|bs24slupca\.pl|bosbank24\.pl|bn\.aliorbank\.pl|bankmillennium\.pl|bank\.bskrasnosielc\.pl|bank\.bsgoworowo\.pl|mbank\.pl|aliorbank\.pl|arcot\.com|bankmillennium\.pl|bankpbs\.pl|bgzbnpparibas\.pl|blikmobile\.pl|bluemedia\.pl|bm\.pl|bosbank\.pl|bosbank24\.pl|bph\.pl|bzwbk\.pl|cashbill\.pl|centrum24\.pl|citibank\.pl|citibankonline\.pl|credit-agricole\.pl|db-pbc\.pl|deutschebank\.pl|dotpay\.pl|ebgz\.pl|eblik\.pl|ecard\.pl|eservice\.pl|eurobank\.pl|firmao\.pl|getinbank\.pl|homepay\.pl|ideabank\.pl|ingbank\.pl|inteligo\.pl|ipko\.pl|mastercard\.pl|mbank\.com\.pl|mbank\.pl|multibank\.pl|nestbank\.pl|noblebank\.pl|nordea\.pl|orangefinanse\.com\.pl|paybynet\.pl|paylane\.pl|paypal\.com|paypal\.pl|payu\.com|pbsbank\.pl|pekao24\.pl|pekaobiznes24\.pl|peopay\.pl|pkobp\.pl|platnosci-online\.pl|platnosci\.pl|plusbank\.pl|plusbank24\.pl|pocztowy24\.pl|polcard\.com\.pl|polcard\.pl|przelewy24\.pl|r-bank\.pl|raiffeisenpolbank\.com|santander24\.pl|securecode\.com|sofort\.com|t-mobilebankowe\.pl|toyotabank\.pl|tpay\.com|transferuj\.pl|transferwise\.com|visa\.pl|vpos\.polcard\.com\.pl|vwbank\.pl|yetipay\.pl|api\.sociaplus\.com|inone\.useinsider\.com|panel\.sociaplus\.com|paypo\.pl|bps\.3dsecure\.itcard\.pl|ckpay\.cinkciarz\.pl|e-bank\.lubuskibs\.pl|okbank\.pl)/;

  // Lista wyszukiwarek z regexami
  var searchEngines = {
    'google': /(^|\.)google\.com$/,
    'bing': /(^|\.)bing\.com$/,
    'yahoo': /(^|\.)yahoo\.com$/
  };

  // Główna funkcja do sprawdzania i zapisywania utm_source i utm_medium
  function checkAndStoreUTM() {
    var utmSource = getParameterByName('utm_source');
    var utmMedium = getParameterByName('utm_medium');
    var gclid = getParameterByName('gclid');
    var fbclid = getParameterByName('fbclid');
    var referrer = document.referrer;

    if (gclid || fbclid) {
      console.log("Setting cookies for gclid or fbclid");
      var source = gclid ? 'google' : 'facebook';
      setCookie('andrzejczyk_source', source, 30);  // Ustawienie ciasteczka na 30 dni
      setCookie('andrzejczyk_medium', 'cpc', 30);    // Ustawienie ciasteczka na 30 dni
      return;
    }

    if (utmSource) {
      console.log("Setting cookies for utm_source");
      setCookie('andrzejczyk_source', utmSource, 30);  // Ustawienie ciasteczka na 30 dni
      setCookie('andrzejczyk_medium', utmMedium, 30);  // Ustawienie ciasteczka na 30 dni
      return;
    }

    if (referrer && !excludedDomainsRegex.test(referrer)) {
      console.log("Setting cookies for referrer");
      try {
        var referrerDomain = (new URL(referrer)).hostname;
        var source = referrerDomain;
        var medium = 'referral';
        
        // Sprawdzenie, czy referrer pochodzi z wyszukiwarki
        for (var key in searchEngines) {
          if (searchEngines[key].test(referrerDomain)) {
            source = key;
            medium = 'organic';
            break;
          }
        }

        setCookie('andrzejczyk_source', source, 30);  // Ustawienie ciasteczka na 30 dni
        setCookie('andrzejczyk_medium', medium, 30);  // Ustawienie ciasteczka na 30 dni
      } catch (e) {
        console.error("Error parsing referrer URL", e);
      }
    }
  }

  // Wywołanie funkcji na załadowaniu strony
  checkAndStoreUTM();
</script>
